<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=414, height=896">
<title>SobatCurhat</title>
<style>
  body {
    margin: 0;
    font-family: Poppins, sans-serif;
    background: #FFFEF0;
  }

  .Chatbot {
    width: 414px;
    height: 896px;
    position: relative;
    background: #FFFEF0;
    margin: auto;
    overflow: hidden;
    border: 1px solid #000;
    border-radius: 20px;
  }

  /* HEADER */
  .header {
    width: 100%;
    height: 180px;
    background: linear-gradient(90deg, #FFEB3B 0%, #FF9800 100%);
    border-radius: 20px 20px 0 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .back-btn {
    position: absolute;
    left: 20px;
    top: 20px;
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
    font-weight: 600;
    color: #333;
    cursor: pointer;
    background: none;
    border: none;
  }

  .back-btn:hover {
    opacity: 0.8;
  }

  .profile-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 2px solid #000;
    object-fit: cover;
    margin-bottom: 10px;
  }

  .header-title {
    font-weight: 700;
    font-size: 20px;
    text-align: center;
  }

  /* CHAT BOX */
  #chat-box {
    margin: 20px auto 0;
    width: 90%;
    height: 530px;
    background: #fff;
    border-radius: 20px;
    border: 1px solid #000;
    overflow-y: auto;
    padding: 10px;
  }

  .user, .bot {
    margin: 10px 0;
    padding: 10px;
    border-radius: 15px;
    max-width: 80%;
    line-height: 1.4em;
  }

  .user {
    background: #FFEB3B;
    margin-left: auto;
  }

  .bot {
    background: #f1f1f1;
  }

  /* INPUT FORM */
  #chat-form {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 370px;
    display: flex;
    gap: 10px;
  }

  #chat-input {
    flex: 1;
    padding: 10px 15px;
    border-radius: 25px;
    border: 1px solid #000;
    outline: none;
    font-size: 16px;
  }

  #send-btn {
    background: linear-gradient(90deg, #FFEB3B 0%, #FF9800 100%);
    border: none;
    border-radius: 25px;
    padding: 0 15px;
    font-weight: bold;
    cursor: pointer;
  }

  #send-btn:hover {
    opacity: 0.9;
  }
</style>
</head>
<body>

<div class="Chatbot">
  <!-- Header -->
  <div class="header">
    <button class="back-btn" onclick="goBack()">
      <img src="Kembali.png" alt="Kembali" width="100"> 
    </button>
    <img src="profile.png" alt="Profil" class="profile-icon">
    <div class="header-title">SobatCurhat</div>
  </div>

  <!-- Chat Box -->
  <div id="chat-box">
    <div class="bot"><b>SobatCurhat:</b><br>Halo! Aku SobatCurhat üòä<br>Ada yang ingin kamu ceritakan hari ini?</div>
  </div>

  <!-- Chat Input -->
  <form id="chat-form">
    <input id="chat-input" type="text" placeholder="Tanyakan sesuatu..." autocomplete="off" />
    <button id="send-btn" type="submit">Kirim</button>
  </form>
</div>

<script>
function goBack() {
  window.history.back();
}

const form = document.getElementById("chat-form");
const input = document.getElementById("chat-input");
const box = document.getElementById("chat-box");

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const message = input.value.trim();
  if (!message) return;

  const userMsg = document.createElement("div");
  userMsg.className = "user";
  userMsg.innerHTML = `<b>Kamu:</b><br>${message}`;
  box.appendChild(userMsg);

  input.value = "";
  box.scrollTop = box.scrollHeight;

  const botMsg = document.createElement("div");
  botMsg.className = "bot";
  botMsg.textContent = "SobatCurhat sedang mengetik...";
  box.appendChild(botMsg);
  box.scrollTop = box.scrollHeight;

  try {
    const res = await fetch("http://127.0.0.1:8000/predict", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: message }),
    });

    const data = await res.json();
    botMsg.innerHTML = `<b>SobatCurhat:</b><br>${data.bot_response || "Maaf, aku belum bisa menjawab pertanyaan itu üòÖ"}`;
  } catch (err) {
    botMsg.innerHTML = "‚ö†Ô∏è Gagal menghubungi server. Pastikan FastAPI kamu berjalan di http://127.0.0.1:8000";
  }

  box.scrollTop = box.scrollHeight;
});
</script>

</body>
</html>
